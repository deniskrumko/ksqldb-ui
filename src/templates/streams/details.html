{% extends "base.html" %}

{% block title %}
ksqlDB UI - Streams - {{current_server_name}}
{% endblock %}

{% block css %}
<link rel="stylesheet" href="/static/css/stream.css">
{% endblock %}

{% block body %}
<div class="my-container">
  <div class="row">
    <div class="col">
      <h2 class="title-h2">Stream <span class="accent-text">{{ stream.sourceDescription.name }}</span> on {{current_server_name}}</h2>

      <!-- Bubbles -->
      {{ render_bubbles(stream.sourceDescription, keys=["keyFormat", "valueFormat", "partitions", "replication",])|safe }}

      <!-- Topic -->
      <div class="section">Topic</div>
      <div>{{ render_json(stream.sourceDescription.topic)|safe }}</div>

      <!-- SQL statement -->
      <div class="section">SQL statement</div>
      <div id="stream-statement" class="ace-editor-custom">{{ stream.sourceDescription.statement }}</div>
      <textarea name="query" id="stream-state" hidden></textarea>

      <!-- Fields -->
      <div class="section">Fields</div>
      {{ render_stream_fields(stream.sourceDescription.fields)|safe }}

        <!-- Stats -->
      {% if stream.sourceDescription.clusterStatistics %}
      <div class="section">Cluster statistics</div>
      {{ render_table(stream.sourceDescription.clusterStatistics, show_line_numbers=False) | safe }}
      {% endif %}

      <!-- Original data -->
      {% with data = stream %}
        {% include "includes/hidden_data.html" %}
      {% endwith %}
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
{{ super() }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.35.3/ace.min.js"
  integrity="sha512-FqIMgoMtiqZWCK+bRO5e4Dsj1uTSbl26DlpTlhoqyunc6o41hkU0fXpXMNLKsqPBIUf4OERya5kfbqscOT26VQ=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
$(document).ready(function() {
  var editor = ace.edit("stream-statement");
  editor.setTheme("ace/theme/chrome");
  editor.session.setMode("ace/mode/sql");
  editor.session.setUseWrapMode(true);
  editor.setReadOnly(true);
})
</script>
{% endblock %}
