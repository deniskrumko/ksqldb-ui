{% extends "base.html" %}

{% block title %}
ksqlDB · {% trans %}Queries{% endtrans %} · {{ current_server.display_name }}
{% endblock %}

{% block body %}
<div class="my-container">

  {% if deleted_query %}
  <!-- Alert -->
   <br>
  <div class="alert alert-success" role="alert">
  {% trans %}Query <b>{{ deleted_query }}</b> successfully deleted!{% endtrans %}
  </div>
  {% endif %}

  <div class="title-group">
    <!-- Title -->
    <h2 class="title-h2">
    {% trans name=current_server.display_name %}Queries on {{ name }}{% endtrans %}
    {% include "includes/help_messages/button.html" %}
    </h2>

    <!-- Buttons -->
    <div class="buttons-group">
      <div id="list-delete-btn" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal" style="display: none;">
        <img src="/static/icons/delete.svg" alt="Delete">
        {% trans %}Delete selected queries{% endtrans %}
      </div>
      <a href="/requests?{{q}}&template=query" class="btn btn-success">
        <img src="/static/icons/plus.svg" alt="Create">
        {% trans %}Create query{% endtrans %}
      </a>
    </div>
  </div>

  <!-- Help -->
  {% include "includes/help_messages/queries.html" %}

  <!-- Filters -->
  {% include "includes/list_page_filters.html" %}

  <!-- Queries -->
  {% if queries %}
  <div class="table-container">
    <table class="table nomargin">
      <thead>
        <tr>
          <th scope="col">
            <input type="checkbox" class="form-check-input" id="select-all">
          </th>
          <th scope="col">#</th>
          <th scope="col">ID</th>
          <th scope="col">{% trans %}Type{% endtrans %}</th>
          <th scope="col">{% trans %}Streams{% endtrans %}</th>
        </tr>
      </thead>
      <tbody>
        {% for query in queries %}
        <tr class="list-view-row" data-filter-name="{{ query.id }}">
          <th>
            <input type="checkbox" class="form-check-input" name="selected_objects" value="{{ query.id }}">
          </th>
          <th scope="row">{{ loop.index }}</th>
          <td>
            <a href="/queries/{{ query.id }}?{{q}}" class="link-offset-2 link-sm breaked">{{ query.id }}</a>
          </td>
          <td>
            {% if query.state == 'RUNNING' %}
            <span class="badge text-bg-success">
            {% else %}
            <span class="badge text-bg-danger">
            {% endif %}
              {{ query.state }}
            </span>
            <span class="badge text-bg-secondary">{{ query.queryType }}</span>
          </td>
          <td>
            <div class="resp">
              <div class="value">
                {% for sink in query.sinks %}
                <div>{{ render_stream_link(request, sink)|safe }}</div>
                {% endfor %}
              </div>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <figure class="fun-quote">
    <blockquote class="blockquote" >
      <p>“ {% trans %}<b>Queries</b> is not something ready made. It comes from your own actions.{% endtrans %} ”</p>
    </blockquote>
    <figcaption class="blockquote-footer">
      {% trans %}Dalai Lama (never said){% endtrans %}
    </figcaption>
  </figure>
  {% endif %}
  {% include "includes/hidden_response_details.html" %}
</div>

{% with objectType="query", deleteEndpoint="/queries" %}
  {% include "includes/modal_delete.html" %}
{% endwith %}
{% endblock %}

{% block js %}
{{ super() }}
<script src="/static/js/modal_delete.js"></script>
<script src="/static/js/list_page.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  // Init all tooltips
  $('[data-toggle="tooltip"]').tooltip()
});
</script>
{% endblock %}
